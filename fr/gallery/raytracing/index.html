<!doctype html>
<html lang="fr"  style="background: #fafdfe">
<head>
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-91929483-3"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-91929483-3');
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script> 
		$(function(){
			$("#header").load("header.html"); 
			$("#footer").load("footer.html"); 
		});
	</script>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="Paul-Elie Pipelin">
	<meta name="description" content="Travaux autour de la synthèse d'image (raytracing, pathtracing, sampling...). Site personnel de Paul-Elie Pipelin, ingénieur en image numérique">
	<meta name="keywords" content="Lancer, Rayon, Path, Ray, Tracing, Synthèse, Synthesis, Ingénieur, Paul-Elie, Pipelin, Numérique, Image">
	<meta name="theme-color" content="#36a1b0">

	<title>Paul-Élie Pipelin - Lancer de rayon</title>
	<base href="/">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Playfair+Display:200,300|Quicksand:300,400|Roboto">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
	<link rel="stylesheet" href="styles.css">
	<link rel="stylesheet" href="gallery/styles.css">
	<link rel="stylesheet" href="gallery/raytracing/styles.css">
	<link rel="icon" type="image/x-icon" href="assets/Torch.png">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/blazy/1.8.2/blazy.min.js"></script>
	<script>
		var blazy = new Blazy({
		container: '#container' // Default is window
	});
</script>
</head>
<body>
	<a class="finger hella bae-rock +" href="en/gallery/raytracing">
		english
	</a>
	<a class="finger hella bae-rock +" href="fr/gallery/raytracing">
		français
	</a>

	<div id="header">
		<h1 class="forehead undertow charming hella ++++">
			Paul-Élie Pipelin
		</h1>
	</div>

	<!------------------------------------------------>

	<nav class="tight stormsurge +++" aria-label="plunge" id="plunge">
		<a class="finger bae-rock hella" href="fr/">home</a>
		<a class="finger bae-rock hella" href="fr/gallery">galerie</a>
	</nav>

	<!------------------------------------------------>
	<em style="color:red; font-weight: bold;">
		NOUVEAU ! Path tracer en WEBGL disponible <a class="finger bae-rock inline" href="experiments/webgltracer">ici</a>
	</em>
	<h1>Ray Tracing et Path Tracing</h1>
	Durant la seconde année à l'ESIR, j'ai développé avec un <a href="https://glennkerbiriou.yj.fr" target="_blank">binôme</a>, un moteur de lancer de rayon. Il fut amélioré de façon incrémentale, commençant comme un simple moteur de lancer de rayon avec couleur diffuse et spéculaire selon le modèle de Phong pour finalement devenir un moteur de Path Tracing utilisant des BRDF et une interface temps réel. Nous l'avons développé en C++.
	<br>
	Pendant la troisième et dernière année à l'ESIR, j'ai participé à un <a class="finger bae-rock inline" href="fr/gallery/raytracing/#industrial">projet industriel</a> sur de la synthèse d'image lui aussi.

	<nav class="tight undertow forehead +++" aria-label="plunge" id="plunge">
		<a class="finger bae-rock hella">Ray tracing - Phong</a>
	</nav>

	Ci-dessous, trois images d'une même scène 3D. La première uniquement composée des couleurs, la seconde utilisant le shader de Phong et la dernière simulant des ombres douces à l'aide d'une lumière ambiante.
	
	<div class="row forehead undertow">
		<div class="col-sm-auto">
			<img class="finger thumb" src="assets/raytracing/CornelEmpty.png" title="Ray tracing rendered image of Cornel Box" alt="Ray Tracing Cornel Box">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb" src="assets/raytracing/CornelPhong.png" title="Ray tracing rendered image of Cornel Box, Phong shader" alt="Ray Tracing Cornel Box Phong Shader">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb" src="assets/raytracing/CornelSoftShadow.png" title="Ray tracing rendered image of Cornel Box, Phong shader with soft shadow" alt="Ray Tracing Cornel Box Phong Shader Soft Shadow">
		</div>
	</div>

	Les images qui suivent sont maintenant composées de lumières émissives, de surface spéculaire ainsi que de textures. Naturellement, nous avons ajouté des structures accélératrices pour accélérer le rendu, un 
	<span class="tooltipcustom">BVH
		<span class="tooltiptext">Bounding Volume Hierarchy</span>
	</span> couplé d'un
	<span class="tooltipcustom">SAH
		<span class="tooltiptext">Surface-Area Heuristic</span>
	</span> comme nous pouvons le voir ci-dessous, la première sans SAH, la dernière avec. Notez comme les boîtes de collision collent mieux à la géométrie de la scène.

	<div class="row forehead undertow">
		<div class="col-sm-auto">
			<img class="finger thumb" src="assets/raytracing/Tibet.png" title="Ray tracing rendered image of Tibet House with emissive lightning" alt="Ray Tracing Tibet House">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb" src="assets/raytracing/TibetHeat.png" title="Ray tracing rendered image of Tibet House's BVH" alt="Ray Tracing Tibet House BVH">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb" src="assets/raytracing/TibetHeatSAH.png" title="Ray tracing rendered image of Tibet House's BVH with SAH" alt="Ray Tracing Tibet House BVH SAH">
		</div>
	</div>

	<nav class="tight undertow forehead +++" aria-label="plunge" id="plunge">
		<a class="finger bae-rock hella">Path Tracing</a>
	</nav>

	Nous avons ensuite ajouté la lumière indirecte, les lumières surfaciques, la stratification des pixels (pour réduire la variance) ainsi que la réfraction. Nous avons ensuite ajouté quelques nouvelles primitives telles que les sphères, anneaux ou cylindres permet de baisser le nombres de primitives et d'améliorer la précision des scènes. Ce moteur est doté d'un rendu temps réel grâce à de l'upscaling, permettant une gestion plus fluide de la caméra. La plupart des fonctions sont donc ainsi gérées depuis le clavier.

	<div class="row forehead undertow">
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/Demo_2000x2000_1154pass_20361s_1strat.jpg" title="Path tracing rendered image of Cornel Box with various primitives" alt="Path Tracing Cornel Box Primitives">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/Corridor_500x500_3953pass_1184s_1strat.jpg" title="Path tracing rendered image of Corridor" alt="Path Tracing Corridor">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/Transparent_1000x1000_2988pass_15457s_1shadowrays_stratification-enabled.jpg" title="Path tracing rendered image of a transparent crocodile" alt="Path Tracing Crocodile Transparent">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/Bathroom_500x500_6117pass_13388s_1strat.bmp" title="Path tracing rendered image of a bathroom" alt="Path Tracing Bathroom">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/RenderedRayTracing.gif" title="Video of path traced rendered animation" alt="Path Tracing Gif Video Render Bubble Transparent Refraction">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/RenderedRayTracingAnnulus.gif" title="Video of path traced rendered animation" alt="Path Tracing Gif Video Render Annulus Transparent Refraction">
		</div>
	</div>

	<nav class="tight undertow forehead +++" aria-label="plunge" id="plunge">
		<a class="finger bae-rock hella">Temps réel</a>
	</nav>

	Le temps réel fut une grande aide pour le débuggage de l'application. Cela a notamment permis de choisir précisément les options de rendus pour nos scènes. Cette option maintiens tout de même de bonnes performances (10-100FPS en fonctions des options sélectionnées) grâce à un upscale et downscale automatique. A l'arrêt, l'image devient de plus en plus nette, permettant de l'antialiasing et du débruitage sur un nombre de passes infini.
	Pour une scène en lancer de rayon (donc sans rayons indirects) le taux de rafraîchissement reste à 60FPS sans problème (sur CPU).
	<!-- Montrer mp4 de mouvement avec antialiasing bili et NN, direct + indirect-->
	<!-- Montrer toggle des heatmap + normales -->

	<nav class="tight undertow forehead +++" aria-label="plunge" id="plunge">
		<a class="finger bae-rock hella" name="industrial">Projet Industriel</a>
	</nav>

	La dernière année à l'ESIR comprend la réalisation d'un projet industriel proposé par une entreprise. Le projet industriel auquel j'ai participé a été proposé par Chaos Czech l'entreprise développant le <a href="https://corona-renderer.com/">Corona Renderer</a>. Ce projet regroupe quatre personnes et consiste en l'implémentation d'un Échantillonnage à Multiple Importances Optimal dans un path tracer bidirectionnel. Il est notamment essentiel que ce dernier soit non biaisé. Nous allons voir ici étapes de ce projet, à commencer par la mise à niveau comprenant du Multiple Importance Sampling, du Light Tracing et du Bidirectional Path Tracing.  

	<nav class="tight undertow forehead ++" aria-label="plunge" id="plunge">
		<a class="finger bae-rock hella" href="https://sites.fas.harvard.edu/~cs278/papers/veach.pdf" target="_blank">Multiple Importance Sampling</a>
	</nav>

	Le MIS implémenté comporte deux méthodes d'échantillonnage, celle des BSDFs et celle des lumières que nous pouvons voir avec 64 passes ci dessous, respectivement. La scène utilisée reprend celle proposée par Veach et Guibas, quatre sphères de couleurs, quatre surfaces aux BSDFs de plus en plus diffuses. La dernière des images correspond aux poids de chaque échantillonnages sélectionnés par la <i>balance heuristic</i>.
	
	<div class="row forehead undertow">
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/veach/64/64BS.png" title="Path tracing rendered image of Veach scene with BSDF sampling" alt="Path Tracing Veach BSDF Sampling">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/veach/64/64LS.png" title="Path tracing rendered image of Veach scene with light sampling" alt="Path Tracing Veach Light Sampling">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/veach/512weight.png" title="Path tracing image of the balance heuristic weights" alt="Path Tracing Veach Balance Heuristic Weight Multiple Importance Sampling MIS">
		</div>
	</div>

	Ci dessous se trouve les rendus de la même scène avec un path tracer classique et le MIS. La troisième image est la soustraction des deux précédentes afin de vérifier qu'il n'y ai pas de biais.

	<div class="row forehead undertow">
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/veach/64/64ref.png" title="Path tracing rendered image of Veach scene" alt="Path Tracing Veach">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/veach/64/64power.png" title="Path tracing rendered image of Veach scene with Multiple Importance Sampling" alt="Path Tracing Veach Multiple Importance Sampling MIS">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/veach/64/64difference.png" title="Substraction between reference and MIS path traced image to verify that it is unbiased" alt="Path Tracing Veach Multiple Importance Sampling MIS Unbiased">
		</div>
	</div>

	Nous pouvons maintenant voir l'effet des poids sur chaque méthode d'échantillonnage ainsi que le résultat final en 2048 passes (500s).
	
	<div class="row forehead undertow">
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/veach/2048/2048BSW.png" title="Path tracing rendered image of Veach scene with weights on BSDF sampling" alt="Path Tracing Multiple Importance Sampling MIS BSDF">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/veach/2048/2048LSW.png" title="Path tracing rendered image of Veach scene with weights on light sampling" alt="Path Tracing Multiple Importance Sampling MIS Light">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/veach/2048/2048power.png" title="Path tracing rendered image of Veach scene with MIS using the balance heuristic" alt="Path Tracing Multiple Importance Sampling MIS Balance Heuristic High Quality">
		</div>
	</div>

	<nav class="tight undertow forehead ++" aria-label="plunge" id="plunge">
		<a class="finger bae-rock hella">Bidirectional Path Tracing</a>
	</nav>

	Le BDPT est implémenté avec la <i>balance heuristic</i>. Cela permet de tracer certains chemins complexes tels que les caustiques ce qui est nécessaire dans certaines scènes. Ci-dessous successivement un Path tracing Naïf, un Light Tracing puis un Bidirectional Path Tracing rendu avec un nombre élevé de passes : 1024. Le BDPT  est en un sens la fusion du PT et du LT car il calcule toutes les possibilité d'échantillonnage d'un même chemin via ces deux techniques.
	Un chemin de 7 vertex peu être échantillonné selon 7 combinaisons, commençant à [<i>s=0;t=7</i>] jusque [<i>s=6;t=1</i>] où <i>s</i> est le nombre de vertex partant de la lumière et <i>t</i> est le nombre de vertex partant de la caméra (<i>radiance and importance</i>). La pdf du chemin courant avec l'échantillonnage courant se calcule en utilisant les pdf forward et reverse.

	<div class="row forehead undertow">
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/NaivePathTracing1024.png" title="Naive Path tracing rendered image of Cornel box with a caustic" alt="Naive Path Tracing Caustic">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/LightTracing1024.png" title="Light tracing rendered image of Cornel box with a caustic" alt="Light Tracing Caustic">
		</div>
		<div class="col-sm-auto">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/BidirectionalPathTracing1024.png" title="Bidirectional Path tracing rendered image of Cornel box with a caustic" alt="Bidirectional Path Tracing Multiple Importance Sampling">
		</div>
	</div>

	<nav class="tight undertow forehead ++" aria-label="plunge" id="plunge">
		<a class="finger bae-rock hella">OptiMIS</a>
	</nav>

	La minimisation complète de la variance de l'estimateur de Monte Carlo ainsi que la libération de la contrainte sur les poids proposées par <a href="https://www.researchgate.net/profile/Pascal_Grittmann/publication/334433762_Optimal_multiple_importance_sampling/links/5d2c695da6fdcc2462e12f96/Optimal-multiple-importance-sampling.pdf" target="_blank">Kondapaneni et. al.</a> a permis une fois de plus de minimiser grandement la variance des images rendues. Cette méthode se base sur l'estimation d'un système linéaire au fur et à mesure des passes permettant de calculer les poids optimaux à appliquer.

	<div class="row forehead undertow">
		<div class="col-sm-auto midly">
			<i>Deux méthodes d'échantillonnage différentes</i>
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/optimis/technique1.jpg" title="Rendered path traced image of sampling technique A" alt="Path Tracing Technique Sampling">
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/optimis/technique2.jpg" title="Rendered path traced image of sampling technique B" alt="Path Tracing Technique Sampling">
		</div>
		<div class="col-sm-auto midly my-auto">
			<i>Balance heuristic</i>
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/optimis/balance.jpg" title="Balance Heuristic Multiple Importance Sampling" alt="Balance Heuristic Multiple Importance Sampling MIS">
		</div>
		<div class="col-sm-auto midly my-auto">
			<i>Poids optimaux</i>
			<img class="finger thumb b-lazy" src="assets/loading.svg" data-src="assets/raytracing/optimis/optimal.jpg" title="Balance Heuristic Optimal Multiple Importance Sampling" alt="Balance Heuristic Optimal Multiple Importance Sampling OptiMIS MIS">
		</div>
	</div>

	Notre tâche fut d'implémenter cette méthode dans un BDPT.
	<br>
	Pour ce faire, les principales contributions furent :
	<ul>
		<li>La correction de certain matériaux ne calculant pas les pdf lors de l'absence de contribution</li>
		<li>La correction du modèle de microfacettes pouvant générer des pdf négatives lors du nouveau calcul de normale</li>
		<li>La prise en compte des chemins de <i>Light Tracing</i></li>
		<li>La prise en compte des chemins sans contribution</li>
	</ul>
	Cette totale intégration a donné des résultats très satisfaisants pour les chemins simples (éclairage direct i.e. avec une technique d'échantillonnage optimale) mais pas pour les chemins plus complexes tels que les caustiques.

	<div class="row forehead undertow">
		<div class="col-sm-auto">
			<img class="finger full" src="assets/raytracing/optimis/glass_demo.jpg" title="Glass with caustic rendered in a Bidirectional Path Tracer" alt="Glass Caustic Rendered Bidirectional Path Tracer">
		</div>
	</div>

	<div id="footer" class="forehead +++"></div>
</body>
</html>
